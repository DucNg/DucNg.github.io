<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Managing a music library using beets | Duc Nguyen</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Growing up as a kid I mostly listened music through my nice mp3 player:
It created some kind a habit to store music locally and even after streaming platforms were widely used, having limited 3G on my smartphone I mostly relied on playing music stored locally. Over the years, my library grew quiet significantly and became harder and harder to organize. I could at any moment choose the easy pass to just throw everything away and switch everything to a streaming platform but I felt kind of nostalgic and as a tech enthusiast I couldn&rsquo;t just rely on someone elses platform for my needs."><meta name=generator content="Hugo 0.111.3"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css rel=stylesheet><meta property="og:title" content="Managing a music library using beets"><meta property="og:description" content="Growing up as a kid I mostly listened music through my nice mp3 player:
It created some kind a habit to store music locally and even after streaming platforms were widely used, having limited 3G on my smartphone I mostly relied on playing music stored locally. Over the years, my library grew quiet significantly and became harder and harder to organize. I could at any moment choose the easy pass to just throw everything away and switch everything to a streaming platform but I felt kind of nostalgic and as a tech enthusiast I couldn&rsquo;t just rely on someone elses platform for my needs."><meta property="og:type" content="article"><meta property="og:url" content="https://ducng.github.io/posts/music/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-18T17:22:15+01:00"><meta property="article:modified_time" content="2022-11-18T17:22:15+01:00"><meta itemprop=name content="Managing a music library using beets"><meta itemprop=description content="Growing up as a kid I mostly listened music through my nice mp3 player:
It created some kind a habit to store music locally and even after streaming platforms were widely used, having limited 3G on my smartphone I mostly relied on playing music stored locally. Over the years, my library grew quiet significantly and became harder and harder to organize. I could at any moment choose the easy pass to just throw everything away and switch everything to a streaming platform but I felt kind of nostalgic and as a tech enthusiast I couldn&rsquo;t just rely on someone elses platform for my needs."><meta itemprop=datePublished content="2022-11-18T17:22:15+01:00"><meta itemprop=dateModified content="2022-11-18T17:22:15+01:00"><meta itemprop=wordCount content="2211"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Managing a music library using beets"><meta name=twitter:description content="Growing up as a kid I mostly listened music through my nice mp3 player:
It created some kind a habit to store music locally and even after streaming platforms were widely used, having limited 3G on my smartphone I mostly relied on playing music stored locally. Over the years, my library grew quiet significantly and became harder and harder to organize. I could at any moment choose the easy pass to just throw everything away and switch everything to a streaming platform but I felt kind of nostalgic and as a tech enthusiast I couldn&rsquo;t just rely on someone elses platform for my needs."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Duc Nguyen</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/contact/ title="Contact page">Contact</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Posts page">Posts</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/cv/ title="Resume page">Resume</a></li></ul><a href=https://www.linkedin.com/in/nguyen-d/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/DucNg/ target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github‚Äî‚ÄîOpens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://ducng.github.io/index.xml target=_blank class="link-transition rss link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="RSS‚Äî‚ÄîOpens in a new window"><svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw9 center ph5"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://ducng.github.io/posts/music/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://ducng.github.io/posts/music/&amp;text=Managing%20a%20music%20library%20using%20beets" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ducng.github.io/posts/music/&amp;title=Managing%20a%20music%20library%20using%20beets" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Managing a music library using beets</h1><time class="f6 mv4 dib tracked" datetime=2022-11-18T17:22:15+01:00>November 18, 2022</time></header><div class="nested-copy-line-height lh-copy Avenir bg-near-white tj f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Growing up as a kid I mostly listened music through my nice mp3 player:</p><p><img src=/mp3.jpg alt="old mp3 player"></p><p>It created some kind a habit to store music locally and even after streaming platforms were widely used, having limited 3G on my smartphone I mostly relied on playing music stored locally. Over the years, my library grew quiet significantly and became harder and harder to organize. I could at any moment choose the easy pass to just throw everything away and switch everything to a streaming platform but I felt kind of nostalgic and as a tech enthusiast I couldn&rsquo;t just rely on someone elses platform for my needs. So I choose the hard pass to try a have a nice pipeline to store, organize and &ldquo;deploy&rdquo; my music.</p><h1 id=storing-music>Storing music</h1><p>Of course like everyone I get my digital music from CDs that I rip using <a href=https://www.exactaudiocopy.org/>Extract Audio Copy</a> üòâ</p><p>Once ripped it&rsquo;s stored on my <a href=https://ducng.github.io/posts/raid5/>RAID5 NAS</a>. This allows me to access my library from any device that has a network access.</p><h1 id=organize-music>Organize music</h1><p>I used to manually put albums I ripped into it&rsquo;s artist folder. It can look innocent at first, but it quickly gets annoying after some time.</p><p>Looking for a command line <a href=https://en.wikipedia.org/wiki/ID3>ID3</a> editor, I came upon an incredibly powerful tool: <a href=https://beets.readthedocs.io>beets</a>.</p><p>It changed the vision I had about my library: from something organic, manually crafted, to something that can get incredibly organized and automated.</p><p>The concept is pretty simple, put all your unorganized files in a folder, run <code>beet import .</code> in this folder and get a fully organized music folder in return. beets uses existing tags on your files and match it with music databases like <a href=https://musicbrainz.org/>MusicBrainz</a> or <a href=https://www.discogs.com/>Discogs</a>. Using those data, it will fix and complete the tags of your files, put them in the correct directory and rename them. It does this according to the configuration you have defined. Here is mine as an example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>directory</span>: <span style=color:#ae81ff>/home/duc/Music</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>default</span>: <span style=color:#ae81ff>$albumartist/[%if{$original_year,$original_year,$year}] $album%aunique{}/$track. $title</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>comp</span>: <span style=color:#ae81ff>Compilations/[%if{$original_year,$original_year,$year}] $album%aunique{}/$track. $title</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>incremental</span>: <span style=color:#66d9ef>yes</span>
</span></span></code></pre></div><p>The <code>directory</code> option allows me to set the directory where I want my organized library to be. This is not easily modifiable in the future since this path will be used to identify file location in the beets database. We don&rsquo;t need to specify the folder for unorganized music since it doesn&rsquo;t really matter, you can run the <code>beet import</code> command on any folder.</p><p>The <code>paths</code> option define how your files will be organized. My way of organizing music isn&rsquo;t too fancy but it gives you a glimpse of how deep you can go with beets.</p><p>First of, let&rsquo;s explain why there is 2 paths defined here. Default is for the usual stuff, albums with a single artist (eventually with featuring), compilation (comp) on the other hand, is for stuff that compile music from different artists so it would not make sense to store them in an artist folder. The comp path is defined by beets but you can also add custom ones using queries if you want. For example, if you can&rsquo;t remember soundtrack composers very well and you would prefer using album names directly you could do that (as seen on the beets documentation):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>albumtype:soundtrack</span>: <span style=color:#ae81ff>Soundtracks/$album/$track $title</span>
</span></span></code></pre></div><p>This will store music tagged as &ldquo;soundtrack&rdquo; in a Soundtrack directory with the name of the album.</p><p>Back to my configuration. First variable is <code>$albumartist</code>, this is pretty straightforward this is just the name of the artist who created the album. Don&rsquo;t confuse it with <code>$artist</code> that indicates the name of the artist(s) on a specific track. This usually includes featuring for example. beets takes really good care to not mess up these two.</p><p>Something I like is to see albums ordered by years of release even when seen from a file browser, so I added a <code>[$year]</code> before the album name. But this is not enough! Sometimes, albums are re released into better versions or recording but I usually have a single version in my library so I don&rsquo;t really care about that. That&rsquo;s why I have 2 variables set: <code>$original_year</code> the original year of the release of the album in case the album is a re release and <code>$year</code> for the usual case where this is just a simple first release of an album. beets allows me to say &ldquo;use this one if available&rdquo; using a simple if condition.</p><p>Then comes the <code>$album%aunique{}</code> thing. I won&rsquo;t go too deep on this one since it&rsquo;s already explained <a href=https://beets.readthedocs.io/en/stable/reference/pathformat.html#aunique>in the documentation</a>. Just think of it as the name of the album without having to worry about duplicates.</p><p>And to finish, <code>$track. $title</code>, <code>$track</code> is for the track number and <code>$title</code> is for the title of the track. An interesting anecdote about that is, the first time I did my configuration, I forgot to add this <code>$track</code> thing and ended up with tracks sorted in alphabetic order. Realizing it I immediately added it, ran <code>beet move</code> and BAM, in a few seconds all my library was organized the way I wanted. This is when I realized how powerful beets could be.</p><p>Another cool thing about track numbers is that it doesn&rsquo;t takes into account multiple CDs. What I usually had before beets is 2 separate folders namely &ldquo;Cool album CD1&rdquo; and &ldquo;Cool album CD2&rdquo; and tracks ordered from 1 in each. I usually hated that since it forces you to go back to the UI to run the second CD after the first one and it&rsquo;s ugly to have twice the same album shown in the album tab of you player when it fact it&rsquo;s the same. With beets, tracks are ordered in natural order even if on a second CD. If each CD contains 5 tracks, first track of the second CD will just be named 6. But beets still keep the info of which tracks belongs to which CD and store it into the ID3. So if you player support it (like mines) you&rsquo;ll get a beautiful CD separators between tracks but everything on the same page. Like so:</p><p><img src=/plex.webp alt="example of multiple CDs in Plex"></p><p>Last option is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>import</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>incremental</span>: <span style=color:#66d9ef>yes</span>
</span></span></code></pre></div><p>This allows me to import new music from my &ldquo;unorganized music folder&rdquo; with just one command. I would usually have to remember what was already imported and what wasn&rsquo;t yet and ran several <code>beet import</code> for each albums. With this option I can just run <code>beet import .</code> and beets will remember what was already imported from this folder and only import the new stuff.</p><p>And this covers my import configuration! So to summaries, I now have a command line tool that allows me, with a single command, to import, organize and tag all my music files. Since it&rsquo;s command line based, I run it directly on my NAS from SSH, no need to move files around between computers.</p><h1 id=deploy-music>&ldquo;Deploy&rdquo; music</h1><p>The question is now, how to listen to this perfectly organize music? When I was 13, this question was easily answered, just drag & drop everything onto the MP3 player and you&rsquo;re good to go! There is no way it makes more than 4 Go right?</p><p><img src=/folder-size.png alt="music folder size 138G"></p><p>Yeah, I kinda store my music as flac now and it can get pretty big. There is no way I&rsquo;m able to store all of it at once on a portable device. So first solution is to access it via network!</p><h2 id=accessing-music-via-js>Accessing music via js</h2><p>It&rsquo;s NAS after all, it&rsquo;s made to have connectivity! My first approach was a funny one. I stole some js code from a music sharing website that allowed playing music from a simple http server index directory. It&rsquo;s just vanilla JavaScript and HTML5 player. I adapted it to work as a <a href=https://caddyserver.com/docs/caddyfile/directives/file_server#browse>Caddy browse template</a>. Unfortunately, I cannot share the code since I stole and it was not open source in the first place, it also doesn&rsquo;t have a license. But I don&rsquo;t think it&rsquo;s an ideal solution anyway. I can still demonstrate how it works tho. <a href=/musicjs.webm>Here is a video of it in action</a>. It really showcase how a well organize music library doesn&rsquo;t require a player scanning all ID3 to be usable.</p><p>This worked well for a time and I&rsquo;m still using it on some occasions. It&rsquo;s very versatile, it can work on any device with an internet access and a web browser. It&rsquo;s also very light. But it lakes some cool functionalities like searching tracks or album across the whole library, playlist and even track list and showing what&rsquo;s playing system wide. So I decided to go for a more complete solution:</p><h2 id=accessing-music-via-plexhttpswwwplextv>Accessing music via <a href=https://www.plex.tv/>Plex</a></h2><p>Okay so this is still HTML5 + JavaScript but in much more refine package. I won&rsquo;t go too deep on this one since it&rsquo;s a quiet well known software already. Just to say, it works really well as a music player the UI is at least as good as Spotify&rsquo;s one. It&rsquo;s also really easy to setup. It&rsquo;s an ideal solution except it&rsquo;s not open source üôÅ. It also works for series and films so it very handful and it works on many devices like phones, smart TVs or gaming console. This is what I use most of the times.</p><h2 id=accessing-music-on-my-phone>Accessing music on my phone</h2><p>So here is the complex part. Accessing music from network works well and I can already do it via Plex but for my phone, I like to keep things offline. Or at least some. Just in case there is no mobile connectivity somewhere.</p><p>My first approach to this problem was just to transfer FLAC files from my pc to my phone. I would swap files on some occasion and I could have a nice subset of my library that I carried around (plus it was lossless). But after having a phone without a sdcard slot, I quickly realized this couldn&rsquo;t last. My library kept growing and I kept wanting to listen to many different things at once on my phone. So I took the big decision:</p><blockquote><p>It has to end. I will listen to lossy audio now (at least on my phone).</p></blockquote><p>First step was finding the right codec. Quickly looking around, <a href=https://opus-codec.org/comparison/>the only right answer is obviously opus</a>. <a href=https://wiki.xiph.org/Opus_Recommended_Settings#Recommended_Bitrates>At 96 Kb/s</a> you get an almost &ldquo;transparent&rdquo; experience so that&rsquo;s what I went for since I have very limited storage.</p><p>Now we need a find a way to get those files converted and transferred. Thankfully beets also has our back on this one. Beets has a plugin called convert that allows to convert files from your library to a specific format. This is what I added to my config file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>convert</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>/home/duc/Lossy musiques</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>never_convert_lossy_files</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>embed</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>auto_keep</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>album_art_maxwidth</span>: <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>copy_album_art</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>format</span>: <span style=color:#ae81ff>opus</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>formats</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>opus</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>command</span>: <span style=color:#ae81ff>ffmpeg -i $source -y -vn -acodec libopus -ab 96k -f opus $dest</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>extension</span>: <span style=color:#ae81ff>m4a</span>
</span></span></code></pre></div><p>This allows me to run <code>beet convert QUERY</code> and have what I want converted into a folder. Don&rsquo;t look too much at the custom ffmpeg command, this is just a workaround to make Samsung read my files.</p><p>Running the command manually can be useful when I want to transfer old music to my phone but pretty painful when it&rsquo;s music I&rsquo;ve just ripped and imported. That&rsquo;s why <a href=https://github.com/beetbox/beets/pull/4302>I made a PR</a> to add a new option, the one you can see here: <code>auto_keep</code> that auto convert files after they&rsquo;ve been imported. It&rsquo;s one interaction less to do!</p><p>After being converted, I manually transfer files to my phone via wifi using TotalCommander. It&rsquo;s not perfect but it works well enough.</p><h1 id=it-is-not-perfect-yet>It is not perfect yet</h1><p>As I just said, this far from being perfect, it&rsquo;s much better than it was but it still requires more interactions than I would like.</p><p>A nice addition would be the ability to auto synchronize the lossy music folder on my NAS with the music folder on my phone. I tried to do this using rsync but didn&rsquo;t succeeded, no Android rsync app could manage ssh keys. Another solution could be to use <a href=https://syncthing.net/>Syncthing</a> but I didn&rsquo;t found a way to only have files added and not deleted (making the sync only one way). I think it&rsquo;s doable but it requires more investigation.</p><p>I also still need to run <code>beet import</code> manually after each rip which is a pain. I tried to automate it using inotify but beets wasn&rsquo;t made to be autonomous, it often requires you to manually take decisions on how you want your music to be tagged. So I gave up.</p><p>There are also some issues with beet in itself. Some artist are not correctly tagged on MusicBrainz creating duplicates in your library it can be frustrating and it&rsquo;s not easy to solve. There is also the issue with japanese artists, since I don&rsquo;t read japanese at all, I have trouble remembering how their name is written in japanese so it makes it hard to find them in the library. It&rsquo;s also a problem from command line when you can&rsquo;t type the name of the folder. A nice solution could be to have them written in <a href=https://en.wikipedia.org/wiki/Romanization_of_Japanese>romaji</a> but <a href=https://github.com/beetbox/beets/issues/1916>apparently it&rsquo;s no easy task</a>.</p><p>But overall, I&rsquo;m still really happy of how it ended up. And of course there is still room for improvement! Don&rsquo;t hesitate to send me an email if you have ideas on how to improve this setup or just to sharing your own!</p><p>See yaa~!</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://ducng.github.io/>&copy; Duc Nguyen 2023</a><div><a href=https://www.linkedin.com/in/nguyen-d/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/DucNg/ target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github‚Äî‚ÄîOpens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://ducng.github.io/index.xml target=_blank class="link-transition rss link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="RSS‚Äî‚ÄîOpens in a new window"><svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></footer><script src=/dist/js/app.3fc0f988d21662902933.js></script></body></html>